<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Storage Inspector</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f0f2f5; color: #111; }
  h1 { font-size: 24px; margin-bottom: 10px; }
  section { margin-bottom: 30px; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
  pre { background: #f5f5f5; padding: 10px; border-radius: 8px; max-height: 300px; overflow:auto; }
  button { padding: 10px 14px; border:none; border-radius:8px; cursor:pointer; margin-top:10px; background:#2563eb; color:#fff; font-weight:600; transition:.2s; }
  button:hover { background:#1e40af; }
  small { display:block; margin-top:5px; color:#555; }
</style>
</head>
<body>

<h1>LocalStorage & IndexedDB Inspector</h1>

<section>
  <h2>LocalStorage</h2>
  <pre id="lsContent">{}</pre>
  <button id="refreshLS">Refresh LocalStorage</button>
  <button id="clearLS" style="background:#dc2626;">Clear LocalStorage</button>
</section>

<section>
  <h2>IndexedDB</h2>
  <pre id="idbContent">Loading...</pre>
  <button id="refreshIDB">Refresh IndexedDB</button>
  <button id="clearIDB" style="background:#dc2626;">Clear All IndexedDB</button>
  <small>Note: This will delete all IndexedDB databases for this origin.</small>
</section>

<script>
  // ----------------- LOCALSTORAGE -----------------
  const lsContent = document.getElementById('lsContent');
  const refreshLS = document.getElementById('refreshLS');
  const clearLS = document.getElementById('clearLS');

  function updateLocalStorageView() {
    const obj = {};
    for(let i=0; i<localStorage.length; i++){
      const key = localStorage.key(i);
      obj[key] = localStorage.getItem(key);
    }
    lsContent.textContent = JSON.stringify(obj, null, 2);
  }

  refreshLS.addEventListener('click', updateLocalStorageView);
  clearLS.addEventListener('click', () => {
    if(confirm('Are you sure you want to clear ALL LocalStorage?')) {
      localStorage.clear();
      updateLocalStorageView();
    }
  });

  updateLocalStorageView();

  // ----------------- INDEXEDDB -----------------
  const idbContent = document.getElementById('idbContent');
  const refreshIDB = document.getElementById('refreshIDB');
  const clearIDB = document.getElementById('clearIDB');

  async function listIDBs() {
    if(!('databases' in indexedDB)) {
      idbContent.textContent = "Your browser does not support listing IndexedDB databases.";
      return;
    }
    try {
      const dbs = await indexedDB.databases();
      idbContent.textContent = JSON.stringify(dbs.map(db => db.name), null, 2);
      return dbs.map(db => db.name).filter(Boolean);
    } catch(e) {
      idbContent.textContent = 'Error fetching IndexedDB: ' + e;
      return [];
    }
  }

  refreshIDB.addEventListener('click', listIDBs);

  clearIDB.addEventListener('click', async () => {
    const dbs = await listIDBs();
    if(dbs.length===0) return alert('No IndexedDB databases found.');
    if(confirm('Delete all IndexedDB databases? This cannot be undone.')) {
      for(const name of dbs) {
        const req = indexedDB.deleteDatabase(name);
        req.onsuccess = () => console.log('Deleted DB:', name);
        req.onerror = () => console.error('Failed to delete DB:', name);
      }
      setTimeout(listIDBs, 500); // refresh view
    }
  });

  // Initial load
  listIDBs();
</script>

</body>
</html>
